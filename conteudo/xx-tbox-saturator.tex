%!TeX root=../tese.tex
%("dica" para o editor de texto: este arquivo Ã© parte de um documento maior)
% para saber mais: https://tex.stackexchange.com/q/78101

\chapter{TBox saturator}

The saturation process consists of extending the TBox with consequences entailed by the role assertions of the ontology. Essentially, a role assertion represents a relation between individuals of the ontology. When we say that $loves(John, Mary)$ and $Nurse(Mary)$ we say that John loves Mary but it also says that there is someone (John) that loves a nurse. It's with this kind of knowledge that we want to saturate the ontology. We could also have the assertions $loves(Mary, Sam)$ and $Scientist(Sam)$, and at this case, we would have that there is someone (John) that loves someone (Mary) that loves a scientist.

To extend with this kind of assertions, we will first create a graph of the relations between the individuals and then traverse all the graph by using a depth-first search (DFS) to add the existential restrictions. 

\begin{itemize}
    \item $\exists r.C$, for all concept assertions $C$ such that $b$ is an instance of $C$, i.e., $C(b) \in \mathcal{O}$
    \item $\exists r.E$, for all existential re
\end{itemize}


\begin{programruledcaption}{Ontology graph creation.\label{prog:create-graph}}
    \begin{lstlisting}[
      language=pseudocode,
      style=pseudocode,
      style=wider,
      functions={},
      specialidentifiers={},
    ]
        // Creates graph of the \textbf{ontology} where each node is an individual 
        // and each edge is an role assertion.
        // \textbf{graph} is an instance of an object that represents an empty graph
        function CreateRelationGraph(ontology)
            for axiom $\in$ ontology do
                if IsRoleAssertion(axiom) then
                    graph.AddNode(axiom.subject)
                    graph.AddNode(axiom.object)
                    graph.AddEdge(axiom.subject, axiom.object, axiom.property) 
                end
            end 

            return graph
        end
    \end{lstlisting}
\end{programruledcaption}

\begin{programruledcaption}{DFS with saturation\label{prog:dfs}}
    \begin{lstlisting}[
      language=pseudocode,
      style=pseudocode,
      style=wider,
      functions={},
      specialidentifiers={},
    ]
        // Saturates the ontology by running a DFS and adding role assertions
        // \textbf{graph} is the created graph from the ontology
        // \textbf{nodes} is a global list of all nodes, all started as \textbf{UNVISITED}
        function DFS(parent, node) // For each iteration of DFS we need the current \textbf{node} and its \textbf{parent}
            nodes[node] := EXPLORED     

            Axioms := $\emptyset$ // List of axioms to be added into the ontology

            for u $\in$ graph[node].getAdjacentNodes() do
                if nodes[u] = UNVISITED then // Important check to avoid cycles
                    Axioms := Axioms + DFS(node, u)
                else if nodes[u] = EXPLORED then
                    Axioms := Axioms + CreateRoleAssertionAxioms(Axioms, graph[node][u])
                    Axioms := Axioms + CreateClassAssertionAxioms(graph[u], graph[node][u])
                end
            end

            if parent != null then
                Axioms := Axioms + CreateRoleAssertionAxioms(Axioms, graph[parent][node])
                Axioms := Axioms + CreateClassAssertionAxioms(graph[node], graph[parent][node])
            end

            nodes[node] := VISITED

            return Axioms
        end
    \end{lstlisting}
\end{programruledcaption}

\begin{programruledcaption}{Add role assertion axioms\label{prog:add-role-assertion-axioms}}
    \begin{lstlisting}[
      language=pseudocode,
      style=pseudocode,
      style=wider,
      functions={},
      specialidentifiers={},
    ]
        // Create role assertion axioms based on the existing axioms and the role specified
        function CreateRoleAssertionAxioms(Axioms, property) 
            NewAxioms := $\emptyset$
            for a $\in$ Axioms do
                NewAxioms := NewAxioms + $\exists property.a$
            end

            return NewAxioms
        end
    \end{lstlisting}
\end{programruledcaption}

\begin{programruledcaption}{Add class assertion axioms\label{prog:add-class-assertion-axioms}}
    \begin{lstlisting}[
      language=pseudocode,
      style=pseudocode,
      style=wider,
      functions={},
      specialidentifiers={},
    ]
        // Create class assertion axioms based on the class assertions related to the \textbf{object}
        function CreateClassAssertionAxioms(object, property) 
            NewAxioms := $\emptyset$
            for c $\in$ ontology.GetClasses(object) do
                NewAxioms := NewAxioms + $\exists property.c$
            end

            return NewAxioms
        end
    \end{lstlisting}
\end{programruledcaption}